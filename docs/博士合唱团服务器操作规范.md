# 博士合唱团服务器维护操作规范

[TOC]

欢迎大家加入博士合唱团技术部，技术部的职责是为合唱团各职能部门、团委会、团员提供信息化工具，向合唱团各类活动提供技术支持，减轻团务的日常工作负担，提高合唱团的运营效率。

技术部的日常的工作就是维护服务器，服务器于2012年由团里的老团员共同出资购买，现架设在国科大雁栖湖校区网络中心。

为了保证服务器的稳定性，避免出现因个人操作不当而引发的数据丢失，现约定如下操作规范，希望大家能自觉遵守。

## 服务器基本信息
以下列出服务器比较老，性能不是很好，配置各项服务的性能参数时，应参照服务器硬件能力。以下列出服务器的基本信息：

- 服务器硬件配置是`1颗单核CPU` `2G内存` `2块1TB的硬盘` `2个网口` 

- 网络中心为我们分配了两个IP，`外网IP:124.16.75.142` 和 `内网IP:124.16.75.143`

- 网络中心为我们分配了一个域名 `phdChorus.ucas.ac.cn`

- 服务器的操作系统是`Ubuntu LTS 16.04`，没有图形操作界面，也建议不要安装图形操作界面，以避免由图形界面带来的不稳定性。

更详细的服务器硬件及外部参数，请参考[服务器硬件及外部参数](https://www.github.com)

## 服务器用户权限
服务器由技术部部长管理，由技术部成员共同维护。技术部部长拥有服务器的root(管理员)权限，部长根据每个人的具体工作为分配具有不同权限的账号。

|  角色  |       个人账号来源        |     权限     |
| :--: | :-----------------: | :--------: |
|  部长  | 继承上一任部长（同时拥有root账号） |   root权限   |
|  成员  |    部长分配 / 上一界成员     | 视负责的具体工作而定 |

每个人应只使用自己的账号，需要操作权限时向部长申请（或由部长给出具体的解决方案），原则上个人不允许使用其他人的账号（账号交叉使用），**禁止向非技术部成员透露个人账号，禁止任何人在root账户下进行日常运维工作**。

## 服务器配置过程的记录
服务器的任何配置过程均需记录到相应的日志中，日志用Markdown语言书写，保存为`.md`文件，服务器的配置日志存放在技术部服务器Git仓库中，关于Git仓库的使用规范，请参阅[博士合唱团技术部Git仓库使用规范](https://www.github.com)。

由`配置服务器`而产生的文件分为两类，一个是`配置文件`本身，一个是`配置日志文件`。`配置文件`指的是你写入的那个配置文件，`配置日志文件`中记录了配置的时间及具体过程。每一次`配置操作`产生一条`配置日志`。

每一项服务产生一个`配置日志文件`，以及一个或多个`配置文件`，需要将这些文件存储在以服务名称命名的文件夹下。例如因为配置服务`vsftpd`，而修改了`ftpuser` `vsftpd.chroot_list` `vsftpd.user_list`三个文件，则需在Git上建立文件夹`vsftpd`，文件夹中存放这三个配置配件，以及一个配置日志文件`vsftpd配置日志`。

**更改服务器配置时，需同步更新Git中相应的配置文件和日志**。

使用Markdown语言写`配置日志文件`，`配置日志文件`由`配置日志文件头`和多条`配置日志`组成，`配置日志文件头`的具体格式如下：

- 文件的创建时间
- 文件的创建者
- 该日志文件记录的服务项
- 该服务项的配置文件的目录结构
- 各配置文件的功能说明 

`配置日志文件头`和`配置日志`用`---------`分隔开，`配置日志`的具体格式如下：

- 时间 (年-月-日 时:分:秒）
- 真实姓名+服务器账户名
- 写入新配置的原因
- 主要涉及到的配置文件
- 详细的配置过程（包括每一条命令，每一行内容）

两条`配置日志`之间用`---------`分隔开。如有疑问，请参考[vsftpd配置日志](https://www.github.com)。


## 服务器开发
涉及到服务器产品开发、测试、上线的操作，请参考[博士合唱团产品开发测试上线规范](https://www.github.com)

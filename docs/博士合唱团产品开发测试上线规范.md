# 博士合唱团产品开发测试上线规范

[TOC]



服务器对合唱团内部提供各类信息服务，包括但不仅限于资源索引和共享、签到数据统计、团内活动信息统计。为保证服务器能够提供稳定的服务，能够一届一届地传承下去，现做如下规范。



## 产品开发流程规范

为保证服务器提供好用、可靠的服务（总不能让大家吐槽技术部做出来的产品难用），开发新产品或新功能时，应严格遵照以下流程：

1. 采集需求，验证需求。采集需求指的是通过各种渠道（例如各职能部门的反馈）收集合唱团在信息服务方面的需求，验证需求指的是走访需求涉及到的用户，看该类用户是否普遍存在这种需求，以及为什么会有这种需求。**不要拍脑袋想需求！**。
2. 整理需求，设计解决方案。将采集到的需求分类整理好，根据每一类需求分别设计解决方案（如何去满足该需求）。
3. 设计前端产品原型，做可用性测试。如解决方案涉及到前端产品，则需设计产品原型（手绘交互图即可），找几个用户验证一下他们是否能明白如何使用这个功能（即可用性测试），根据用户反馈改进产品设计。
4. 设计后端技术方案，请技术部成员评审。产品前端设计好后，后端与前端共同设计接口。同时后端人员设计技术方案，请技术部成员评审方案，根据评审意见修改方案。简单的功能点找一两个人商量下即可，复杂的功能需要找部长及至少2位成员共同评审。
5. 开发产品，做白盒测试。开发人员开发产品，同时自己做[白盒测试](https://baike.baidu.com/item/%E7%99%BD%E7%9B%92%E6%B5%8B%E8%AF%95/934440?fr=aladdin)，测试用例最好能做到`逻辑覆盖`。
6. 内测。邀请几个核心用户使用产品，看看产品是否有逻辑Bug。如果发生了修复Bug的行为，需要对改进后的产品做[回归测试](https://baike.baidu.com/item/%E5%9B%9E%E5%BD%92%E6%B5%8B%E8%AF%95)。
7. 上线新产品。上线新产品应该在不影响用户使用的时间段进行，建议将每周周四晚21:00-24:00设为服务器停服维护时间。

以上涉及到开发、测试、编码、文件存储的地方，应严格遵守下文提到的各类规范。




## 开发测试规范
开发测试新功能时，**禁止直接在服务器上做正式的编码工作，禁止在线上环境中测试代码**，请参考下面的姿势来做开发和测试。

* 测试环境和线上环境拥有完全相同的逻辑结构，前者用作新功能测试，后者是用户使用的正式环境。
* 开发新功能时，在本地编写好业务代码，并编译通过，建议走查代码，检查逻辑Bug。
* 需要更新服务器上的业务代码时，请用FTP将代码文件直接上传到相应文件夹下。
* __测试__新功能时，请将新的业务代码文件放到__测试环境__下，进行各项测试。如果新功能涉及到数据库读写，请在代码里连接__测试数据库__，在测试数据库中读写数据。
* 上线新功能时，将代码中连接的数据库改为__线上数据库__，将新的业务代码文件一次性放入线上环境。

以`签到小程序`为例。在Apache服务根目录下建立phdChorusRegist文件夹，存放业务代码文件，在数据库服务器建立phdChorusRegist数据库，这二者组合作为线上环境。在Apache服务根目录下建立test_phdChorusRegist文件夹，在数据库服务器建立test_phdChoruRegist数据库（与phdChorusRegist具有完全相同的结构），这二者组合作为测试环境。



## 编码规范
为使服务器业务代码得到可持续的维护（避免其他人看不懂代码，无法维护），现约定如下编码规范。

* 尽量使用能代表变量用途的变量名，避免使用a、b、c这种没有具体含义的变量名。
* 关键变量名、关键行应该有注释。
* 函数（接口）前应该详细注释函数的功能，输入，输出等。如果函数中用到了算法，还需注释算法名或算法的思路。具体请参考下文中的`接口及函数注释规范`。
* 类接口文件中应有对类功能的详细描述，应详细注释每个接口，详见`类接口文件注释规范`

### 函数及接口注释规范

以下是函数（接口）注释示例：

```php
    /**
     * 接口功能
     * 获取签到表中的出勤名单
     *
     * 参数
     * registTableID // 选择的签到表的id
     * contactLocationType  // 需要统计的园区 0-都统计 | 1-只统计中关村 | 2-只统计雁栖湖
     *
     * 返回值
     * registInfo // 出勤名单{'S1': {'attend': ['刘晓雯', ...], 'absent': ['小白姐', ...]}, ....}
     * // S1-声部名 & attend-出勤名单 & absent-缺勤名单 
     *
     */
    public function registInfoOfRegistTable($registTableID, $contactLocationType) : array;
```

- 第1项：函数（接口）的功能；
- 第2项：`参数`列表，每行1个参数，参数名+注释，如参数是枚举值，需在注释中枚举每一个值及其含义；
- 第3项：`返回值`列表，每行1个返回值，返回值名+注释，注释中给出返回值的按照[json数据格式](https://baike.baidu.com/item/JSON)，并注明`key-value`对中`key`的含义。

### 类接口文件注释规范

类对象应有专门的接口文件或接口描述区域，应在接口文件的头部详细注释类的功能，同时在类成员变量和接口做详细注释。



## 文件存储规范

### 目录结构注释规范

每一级文件夹下，都应有`README.md`文件，README中记录了该文件夹的目录结构以及各文件/目录的描述。开发测试时，如果产生了新的文件，应及时在README中补充该文件的描述信息。目录结构有任何变化，都应同步到README文件中，README文件的具体格式请参考[DEMO](www.baidu.com)

### 文件存储

开发测试过程中产生的业务文件、测试脚本、设计文档、注释文档等都应该上传到薄荷服务器Git仓库中，具体请参考[博士合唱团服务器Git仓库使用规范](www.baidu.com)

注意：与业务无关的文件（例如本地IDE产生的工程配置文件，服务依赖的第三方库），不要上传到Git中。